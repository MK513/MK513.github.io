name: deploy # workflow ì´ë¦„ì€ 'deploy'

on: # ì´ workflowê°€ ë°˜ì‘í•˜ëŠ” ì¡°ê±´ë“¤
  push: # pushê°€ ì¼ì–´ë‚¬ì„ ë•Œ
    branches: # pushê°€ ì¼ì–´ë‚˜ëŠ” branch ì¢…ë¥˜ 2ê°€ì§€
      - master
      - main
  pull_request: # pull_request ë°œìƒí–ˆì„ë•Œ
    branches: # pull_requestê°€ ì¼ì–´ë‚˜ëŠ” branch ì¢…ë¥˜ 2ê°€ì§€
      - master
      - main
  workflow_dispatch: # ìˆ˜ë™ìœ¼ë¡œ trigger ë°œìƒì‹œì¼°ì„ ë•Œ

permissions: # workflow ê¶Œí•œ ì„¤ì •
  contents: write # ì“°ê¸° ê¶Œí•œì„ ì„¤ì •í•¨

jobs: # ì´í•˜ ë‚´ìš©ë“¤ì„ jobsìœ¼ë¡œ ì •ì˜í•¨
  deploy: # ì´í•˜ ë‚´ìš©ì„ deploy ë¼ëŠ” ì´ë¦„ì˜ jobìœ¼ë¡œ ì •ì˜í•¨
    # available images: https://github.com/actions/runner-images#available-images
    runs-on: ubuntu-latest # ìš°ë¶„íˆ¬ ìµœì‹  ë²„ì „ì—ì„œ ì‹¤í–‰ë¨
    steps: # ì´í•˜ ë‚´ìš©ë“¤ì„ stepsë¡œ ì •ì˜í•¨
    - name: Checkout ğŸ›ï¸  # ì²«ë²ˆì§¸ step ì´ë¦„ì€ 'Checkout'
      uses: actions/checkout@v3 # ë ˆí¬ì˜ ì†ŒìŠ¤ì½”ë“œë¥¼ ë‚´ë ¤ë°›ìŒ
      
    - name: Setup Ruby  # ë‘ë²ˆì§¸ step ì´ë¦„ì€ 'Setup Ruby'
      uses: ruby/setup-ruby@v1 # Ruby í™˜ê²½ ì„¤ì •í•¨
      with: # ì„¸ë¶€ ë‚´ìš© ì„¤ì •
        ruby-version: '3.2.2' # Ruby versionì„ 3.2.2ë¡œ ì„¤ì •í•¨
        bundler-cache: true  # Bundlerì˜ cacheë¥¼ í™œì„±í™”í•¨
        
    - name: Update _config.yml âš™ï¸ # ì„¸ë²ˆì§¸ step ì´ë¦„ì€ 'Update _config.yml'
      uses: fjogeleit/yaml-update-action@v0.13.1 # YAML íŒŒì¼ì˜ ì—…ë°ì´íŠ¸ë¥¼ ìë™í™”
      with: # ì„¸ë¶€ ë‚´ìš© ì„¤ì •
        commitChange: false # YAML íŒŒì¼ì´ ì—…ë°ì´íŠ¸ë˜ì–´ë„ ìë™ìœ¼ë¡œ ì»¤ë°‹ë˜ì§€ ì•ŠìŒ
        valueFile: '_config.yml' # ì—…ë°ì´íŠ¸í•  íŒŒì¼ì˜ ê²½ë¡œ
        propertyPath: 'giscus.repo' # ì—…ë°ì´íŠ¸í•  ì†ì„±ì˜ ê²½ë¡œ
        value: ${{ github.repository }} # ê²½ë¡œì— ìƒˆë¡œ í• ë‹¹í•  ê°’
        
    - name: Install and Build ğŸ”§ # ë„¤ë²ˆì§¸ step ì´ë¦„ì€ 'Install and Build'
      run: | # ì´í•˜ ëª…ë ¹ë“¤ì„ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•¨
        pip3 install --upgrade jupyter  # Jupyter ë²„ì „ ì—…ë°ì´íŠ¸
        npm install -g mermaid.cli # Mermaid CLI ì „ì—­ ì„¤ì¹˜
        npm install -g purgecss # Purgecss ì „ì—­ ì„¤ì¹˜
        export JEKYLL_ENV=production # jekyll_env í™˜ê²½ë³€ìˆ˜ ì„¤ì •í•´ì„œ í”„ë¡œë•ì…˜í™˜ê²½ì—ì„œ ì‹¤í–‰
        bundle exec jekyll build --lsi # í”„ë¡œì íŠ¸ ë¹Œë“œ
        purgecss -c purgecss.config.js # ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” CSS ì œê±°
        
    - name: Deploy ğŸš€ # ë‹¤ì„¯ë²ˆì§¸ step ì´ë¦„ì€ 'Deploy'
      if: github.event_name != 'pull_request' # pull_requestê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì‹¤í–‰
      uses: JamesIves/github-pages-deploy-action@v4 # í”„ë¡œì íŠ¸ ë°°í¬
      with: # ì„¸ë¶€ ë‚´ìš© ì„¤ì •
        folder: _site # ë°°í¬í•  í´ë” ì§€ì •

